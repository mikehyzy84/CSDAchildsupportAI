# PDF Ingestion Scripts

## Overview
This directory contains scripts for ingesting PDF documents into the CSDAI database.

## Prerequisites
- Node.js installed
- `.env` file with `DATABASE_URL` configured
- Required packages: `pdf-parse`, `@neondatabase/serverless`, `dotenv`

## Usage

### Ingest a PDF Document

```bash
node scripts/ingest-pdf.js <path-to-pdf-file>
```

### Example: Ingest CSDA Attorney Sourcebook

```bash
node scripts/ingest-pdf.js "2024 CSDA Attorney Sourcebook_Digital Book_unprotected.pdf"
```

## What the Script Does

1. **Reads the PDF** using pdf-parse
2. **Extracts text** from all pages
3. **Chunks the text** into ~500 token pieces (approximately 2000 characters)
4. **Preserves section headers** like "Chapter 1", "Section A", etc.
5. **Creates a document record** in the `documents` table
6. **Inserts all chunks** into the `chunks` table
7. **Auto-generates search vectors** via database trigger
8. **Sets status to "completed"**

## Output

The script will print:
- Number of pages in the PDF
- Total text length
- Number of chunks created
- Section headers detected
- Progress updates during insertion
- Final summary with document ID and chunk count

## Database Schema

The script inserts into:
- **documents table**: Main document metadata
  - title: "2024 CSDA Attorney Sourcebook"
  - source: "CSDA Sourcebook"
  - status: "completed"

- **chunks table**: Text chunks with search vectors
  - document_id: Foreign key to documents
  - content: The chunked text
  - section_title: Extracted section header
  - chunk_index: Sequential order
  - search_vector: Auto-generated by database trigger

## Token Estimation

The script uses a simple approximation: **1 token â‰ˆ 4 characters**

This gives us chunks of approximately 500 tokens (2000 characters) each, which is optimal for:
- Search result relevance
- LLM context windows
- Database storage efficiency

## Error Handling

The script will exit with an error if:
- No PDF path is provided
- PDF file doesn't exist
- Database connection fails
- Insertion fails

## Adding More PDFs

To ingest additional documents:
1. Place the PDF in your project directory
2. Run the script with the PDF path
3. Each document gets a unique ID and separate chunks
